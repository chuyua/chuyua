<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>利用 GitHub Action 实现自动化 | Lioil&#39;s Blog</title><meta name="keywords" content="教程, GitHub Action, 自动化"><meta name="description" content="博客部署？我用 GitHub Action 自动部署百度收录推送？我也用 GitHub Action 自动推送"><meta property="og:type" content="article"><meta property="og:title" content="利用 GitHub Action 实现自动化"><meta property="og:url" content="https://www.linil.ml/posts/use-github-action.html"><meta property="og:site_name" content="Lioil&#39;s Blog"><meta property="og:description" content="博客部署？我用 GitHub Action 自动部署百度收录推送？我也用 GitHub Action 自动推送"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://rmt.dogedoge.com/fetch/royce/storage/use-github-action/cover.png?fmt=webp"><meta property="article:published_time" content="2020-07-05T02:22:30.000Z"><meta property="article:modified_time" content="2020-08-07T03:26:28.486Z"><meta property="article:author" content="Lioil"><meta property="article:tag" content="教程"><meta property="article:tag" content="GitHub Action"><meta property="article:tag" content="自动化"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://rmt.dogedoge.com/fetch/royce/storage/use-github-action/cover.png?fmt=webp"><link rel="alternate" href="/atom.xml" title="Lioil's Blog"><link rel="stylesheet" href="/css/style/main.css"><link rel="stylesheet" href="/css/style/dark.css"><script src="/js/darkmode.js"></script><link rel="stylesheet" id="hljs-default-theme" href="/css/highlight/default.css" media="none" onload='-1===getComputedStyle(document.documentElement).getPropertyValue("--color-mode").indexOf("dark")&&(this.media="all")'><link rel="stylesheet" id="hljs-dark-theme" href="/css/highlight/dark.css" media="none" onload='-1!==getComputedStyle(document.documentElement).getPropertyValue("--color-mode").indexOf("dark")&&(this.media="all")'><link rel="stylesheet" href="/css/style/note.css" media="none" onload='this.media="all"'><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Lioil's Blog" type="application/atom+xml"></head><body><div id="app"><header class="header"><div class="header__left"><a href="/" class="button"><span class="logo__text">Lioil's Blog</span></a></div><div class="header__right"><div class="cover__menus"><a href="https://travellings.now.sh/" target="_blank" rel="noopener external nofollow noreferrer" class="cover-menu button">开往 </a><a href="/friends/" class="cover-menu button">友链 </a><a href="/about/" class="cover-menu button">关于 </a><a href="/atom.xml" class="cover-menu button">订阅</a></div><a href="javaScript:void(0);" rel="external nofollow noreferrer" id="btn-toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> </a><a href="#" id="b2t" style="display:block" aria-label="Back to Top" title="Back to Top"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="32" height="32" fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path d="M13.889,11.611c-0.17,0.17-0.443,0.17-0.612,0l-3.189-3.187l-3.363,3.36c-0.171,0.171-0.441,0.171-0.612,0c-0.172-0.169-0.172-0.443,0-0.611l3.667-3.669c0.17-0.17,0.445-0.172,0.614,0l3.496,3.493C14.058,11.167,14.061,11.443,13.889,11.611 M18.25,10c0,4.558-3.693,8.25-8.25,8.25c-4.557,0-8.25-3.692-8.25-8.25c0-4.557,3.693-8.25,8.25-8.25C14.557,1.75,18.25,5.443,18.25,10 M17.383,10c0-4.07-3.312-7.382-7.383-7.382S2.618,5.93,2.618,10S5.93,17.381,10,17.381S17.383,14.07,17.383,10"></path></svg> </a><a class="dropdown-icon button" id="btn-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="24" height="24" fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314,4.8h13.372c0.41,0,0.743-0.333,0.743-0.743c0-0.41-0.333-0.743-0.743-0.743H3.314c-0.41,0-0.743,0.333-0.743,0.743C2.571,4.467,2.904,4.8,3.314,4.8z M16.686,15.2H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,15.2,16.686,15.2z M16.686,9.257H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,9.257,16.686,9.257z"></path></svg></a><div class="dropdown-menus" id="dropdown-menus"><a class="dropback-icon button" id="btn-dropback"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="24" height="24" fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M11.469,10l7.08-7.08c0.406-0.406,0.406-1.064,0-1.469c-0.406-0.406-1.063-0.406-1.469,0L10,8.53l-7.081-7.08c-0.406-0.406-1.064-0.406-1.469,0c-0.406,0.406-0.406,1.063,0,1.469L8.531,10L1.45,17.081c-0.406,0.406-0.406,1.064,0,1.469c0.203,0.203,0.469,0.304,0.735,0.304c0.266,0,0.531-0.101,0.735-0.304L10,11.469l7.08,7.081c0.203,0.203,0.469,0.304,0.735,0.304c0.267,0,0.532-0.101,0.735-0.304c0.406-0.406,0.406-1.064,0-1.469L11.469,10z"></path></svg> </a><a href="https://travellings.now.sh/" target="_blank" rel="noopener external nofollow noreferrer" class="dropdown-menu button">开往 </a><a href="/friends/" class="dropdown-menu button">友链 </a><a href="/about/" class="dropdown-menu button">关于 </a><a href="/atom.xml" class="dropdown-menu button">订阅</a></div><script>document.getElementById('btn-dropdown').addEventListener('click', () => {
                    const dd = document.getElementById('dropdown-menus');
                    requestAnimationFrame(() => {
                        dd.style.display = 'flex';
                        requestAnimationFrame(() => {
                            dd.style.transform = 'translateY(0)';
                            dd.style.opacity = '1';
                        });
                    });
                });
                document.getElementById('btn-dropback').addEventListener('click', () => {
                    const dd = document.getElementById('dropdown-menus');
                    dd.style.transform = 'translateY(2.25rem)';                    
                    dd.style.opacity = '0';
                    setTimeout(() => {dd.style.display = 'none';}, 350);
                });</script></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">利用 GitHub Action 实现自动化</h1><div class="post-title__meta"><a href="/archives/2020/07/" class="button" style="color:grey">Posted Jul 05 2020</a></div></div><div class="post__with-side"><aside class="post-side"><div class="post-side__toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#github-page"><span class="toc-text">GitHub Page</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#coding-page"><span class="toc-text">Coding Page</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gitee-page"><span class="toc-text">Gitee Page</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vercel"><span class="toc-text">Vercel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动部署"><span class="toc-text">自动部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#连接-github"><span class="toc-text">连接 GitHub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写-github-action"><span class="toc-text">编写 GitHub Action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署到-github-page"><span class="toc-text">部署到 GitHub Page</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署到腾讯静态托管"><span class="toc-text">部署到腾讯静态托管</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#部署到-腾讯cos"><span class="toc-text">部署到 腾讯COS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他"><span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#隐私问题"><span class="toc-text">隐私问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自动提交百度收录"><span class="toc-text">自动提交百度收录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后"><span class="toc-text">最后</span></a></li></ol></div></aside><article class="post content-card"><div class="post__header"><img alt="Cover Image" src="https://rmt.dogedoge.com/fetch/royce/storage/use-github-action/cover.png?fmt=webp" class="lazyload" data-srcset="https://rmt.dogedoge.com/fetch/royce/storage/use-github-action/cover.png?fmt=webp" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg=="><div class="post__expire" id="post-expired-notify"><p>This article was last updated on <span id="expire-date"></span> days ago, the information described in the article may be outdated.</p></div><script>(() => {
            var update = Date.parse("2020-08-07"),
                date = new Date(),
                now = date.getTime(),
                expire = now - update,
                expire_days = Math.floor(expire/(24*3600*1000));
            if (expire_days >= 120) {
                document.querySelectorAll('#expire-date')[0].innerHTML = expire_days;
                document.querySelectorAll('#post-expired-notify')[0].style.display = 'block';
            }
        })();</script></div><div class="post__content"><div class="md-content"><h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2><p>首先，为什么选择静态网站？没后台，没数据库，但是方便折腾，可以完全自定义，这是我选择静态博客最大的原因之一。 <s>（其实没钱买服务器才是最大原因）</s></p><p>部署静态网站的方法很多，GitHub Page, Coding Page, Gitee Page, Vercel 都是免费的，各有各的优势，先说说这几个免费的。</p><h3 id="github-page"><a class="markdownIt-Anchor" href="#github-page"></a> GitHub Page</h3><p>Github Page 巨硬家的东西，除非不可抗力，要不然出问题的概率很小。但国内部分地区无法访问，部分地区访问速度慢。能利用 Github Action 实现自动化部署。速度问题或许可以通过 CloudFlare 的 CDN 来解决，但速度还是不怎么样。当然，如果你域名备案了，用国内的 CDN 也是没问题的。</p><h3 id="coding-page"><a class="markdownIt-Anchor" href="#coding-page"></a> Coding Page</h3><p>Coding Page 表明是 Coding 的，但 Coding 现在算是腾讯的了，出问题的概率也很小。但用的节点全是境外的，一般是香港和新加坡…，而且日常宕机，动不动就崩了。同样能利用 集成CI 进行自动部署。</p><h3 id="gitee-page"><a class="markdownIt-Anchor" href="#gitee-page"></a> Gitee Page</h3><p>Gitee Page 码云家的，国内节点，速度没得说，快就完事了。自定义域名和自动更新（也就是说每次更新博客，推送到码云之后还要手动点击部署）需要购买 Pro 版，99 元/年。但因为是国内节点的原因，绑定的域名需要备案。码云还有个比较好的功能，能自动判断博客类型，支持 Jekyll、Hugo、Hexo，能自动进行编译，并部署生成的文件，也就是说你可以直接将整个博客文件夹推上去，每次更新只需要使用 git 推送下就行了，它会帮你生成。</p><h3 id="vercel"><a class="markdownIt-Anchor" href="#vercel"></a> Vercel</h3><p>Vercel 可以直接从 GitHub 导入博客仓库，且能识别静态博客类型，和码云一样自动生成。顺便看了下 Vercel 分配的节点，美国的，但是国内访问速度还是不错的，Ping 了一下，平均 62.0ms，速度也还不错（至少我这是这样）。</p><h3 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h3><ul><li><p>不要求自定义域名，无脑上码云</p></li><li><p>要自定义域名上 GitHub Page or Vercel</p></li><li><p>Coding 不推荐</p></li></ul><p>那么本博客目前并没有采用上述方式进行部署，但全部体验过。因为域名进行了备案，就直接采用了腾讯的<strong>静态网站托管</strong>。</p><p>有一说一，国内各家的 CDN 计费规则是真的复杂，第一次看完基本都一头雾水，这时候腾讯的云开发出现了。云开发中包含了静态网站托管，专为静态网站而生。计费规则很简单，<code>流量费用</code> + <code>空间费用</code>，而且自动部署到 CDN 上，速度超快。</p><p>至于怎么使用云开发部署静态博客，官方已经给出了详细教程 <a href="https://cloud.tencent.com/document/product/1210/43365" target="_blank" rel="noopener external nofollow noreferrer">静态网站托管 搭建 Hexo - 最佳实践 - 文档中心 - 腾讯云</a>。</p><p>当然，这是收费的，不过挺便宜的，正常小站一个月不超过一元，而且还可以申请腾讯的 <a href="https://cloud.tencent.com/act/pro/wh99" target="_blank" rel="noopener external nofollow noreferrer">云开发网站托管「9.9包年」赞助计划</a>。</p><h2 id="自动部署"><a class="markdownIt-Anchor" href="#自动部署"></a> 自动部署</h2><p>接下来进入重点，利用 GitHub Action 实现自动化部署，如果你还不知道 GitHub Action 是什么，可以看看 <a href="https://github.com/features/actions" target="_blank" rel="noopener external nofollow noreferrer">官方介绍</a>，简单来说，以你的仓库为根目录，给你一台电脑，帮你完成一些事情。如果想进一步了解，可以看看 <a href="https://zkqiang.cn/posts/e8ed6836/" target="_blank" rel="noopener external nofollow noreferrer">编写自己的 GitHub Action，体验自动化部署</a></p><h3 id="连接-github"><a class="markdownIt-Anchor" href="#连接-github"></a> 连接 GitHub</h3><p>保证你的整个博客文件夹已 <code>push</code> 到了GitHub 上。如果没有，新建一个仓库 <code>Public</code> or <code>Private</code> 均可，然后将本地本地与仓库连接。</p><p><code>username</code> 替换成用户名，<code>repo</code> 替换成仓库名</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"first commit"</span></span><br><span class="line">git remote add origin https://github.com/username/repo.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><blockquote class="blockquote-note blockquote-note__warning"><div class="blockquote-note__header"><div class="blockquote-note__icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></div>🚨 注意</div><div class="blockquote-note__content"><p>如果仓库为 <code>Public</code> 请不要将隐私内容直接写在文件中，暂时用一些单词替换，后续编写自动部署文件时有方法解决</p></div></blockquote><h3 id="编写-github-action"><a class="markdownIt-Anchor" href="#编写-github-action"></a> 编写 GitHub Action</h3><p>从这里开始，默认你已经看完之前提到的『编写自己的 GitHub Action，体验自动化部署』，或者对 GitHub Action 有初步的了解，知道大致操作。</p><p>以我的<a href="https://JalenChuh.cn" target="_blank" rel="noopener external nofollow noreferrer">个人主页</a>为例，是由 Vue.js 构建的，部署在腾讯云静态网站托管。GitHub 仓库地址：<a href="https://github.com/jalenchuh/homepage" target="_blank" rel="noopener external nofollow noreferrer">homepage</a></p><p>共分为 <code>Setup</code> <code>Build</code> <code>Lint</code> <code>Deploy</code> 四个步骤</p><ul><li><p>Setup: 安装 node 环境</p></li><li><p>Build: 构建</p></li><li><p>Lint: Lint 代码</p></li><li><p>Deploy: 推送到腾讯静态网站托管</p></li></ul><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">'10.x'</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Lint</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">lint</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">deployStatic</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">TencentCloudBase/cloudbase-action@v1.1.1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">secretId:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SECRET_ID</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">secretKey:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SECRET_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">envId:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ENV_ID</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">staticSrcPath:</span> <span class="string">dist</span></span><br></pre></td></tr></table></figure><blockquote class="blockquote-note blockquote-note__info"><div class="blockquote-note__header"><div class="blockquote-note__icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>对于隐私数据须在 secrets 中设置</div><div class="blockquote-note__content"><p>文件中出现的 <code>secrets.xxx</code> 须在仓库的 <code>settings &gt; secrets</code> 中设置</p><p>新建 <code>secrests</code> 时，<code>name</code> 为 <code>xxx</code> ，<code>Value</code> 为内容</p></div></blockquote><h3 id="部署到-github-page"><a class="markdownIt-Anchor" href="#部署到-github-page"></a> 部署到 GitHub Page</h3><p><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span>                      <span class="comment"># Actions 显示的名字，随意设置</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> <span class="string">[push]</span>                        <span class="comment"># 监听到 push 事件后触发</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span>              <span class="comment"># 拉取当前执行 Actions 仓库的指定分支</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">ref:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Update</span> <span class="string">Submodule</span>      <span class="comment"># 如果仓库有 submodule，在这里更新，没有则删掉此步骤</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">git</span> <span class="string">submodule</span> <span class="string">init</span></span><br><span class="line">        <span class="string">git</span> <span class="string">submodule</span> <span class="string">update</span> <span class="string">--remote</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node</span>            <span class="comment"># 安装 Node 环境</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">"10.x"</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">Generate</span>         <span class="comment"># 安装 Hexo 依赖并且生成静态文件</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">rm</span> <span class="string">-f</span> <span class="string">.yarnclean</span></span><br><span class="line">        <span class="string">yarn</span> <span class="string">--frozen-lockfile</span> <span class="string">--ignore-engines</span> <span class="string">--ignore-optional</span> <span class="string">--non-interactive</span> <span class="string">--silent</span> <span class="string">--ignore-scripts</span> <span class="string">--production=false</span></span><br><span class="line">        <span class="string">rm</span> <span class="string">-rf</span> <span class="string">./public</span></span><br><span class="line">        <span class="string">yarn</span> <span class="string">run</span> <span class="string">hexo</span> <span class="string">clean</span></span><br><span class="line">        <span class="string">yarn</span> <span class="string">run</span> <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">Deploy</span>           <span class="comment"># 部署步骤，这里以 hexo deploy 为例</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="attr">SSH_PRIVATE:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SSH_PRIVATE</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">GIT_NAME:</span> <span class="string">yourname</span></span><br><span class="line">        <span class="attr">GIT_EMAIL:</span> <span class="string">your@email.com</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">mkdir</span> <span class="string">-p</span> <span class="string">~/.ssh/</span></span><br><span class="line">        <span class="string">echo</span> <span class="string">"$SSH_PRIVATE"</span> <span class="string">|</span> <span class="string">tr</span> <span class="string">-d</span> <span class="string">'\r'</span> <span class="string">&gt;</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">        <span class="string">chmod</span> <span class="number">600</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">        <span class="string">ssh-keyscan</span> <span class="string">github.com</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">        <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">"$GIT_NAME"</span></span><br><span class="line">        <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">"$GIT_EMAIL"</span></span><br><span class="line">        <span class="string">yarn</span> <span class="string">run</span> <span class="string">hexo</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure><h3 id="部署到腾讯静态托管"><a class="markdownIt-Anchor" href="#部署到腾讯静态托管"></a> 部署到腾讯静态托管</h3><p>建议使用<a href="https://github.com/TencentCloudBase/cloudbase-action" target="_blank" rel="noopener external nofollow noreferrer">官方 Action</a></p><p>示例代码</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> <span class="string">[push]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">'10.x'</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Hexo</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-cli</span> <span class="string">-g</span></span><br><span class="line">        <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">hexo</span> <span class="string">clean</span> <span class="string">&amp;&amp;</span> <span class="string">hexo</span> <span class="string">g</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">deployStatic</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">TencentCloudBase/cloudbase-action@v1.1.1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">secretId:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SECRET_ID</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">secretKey:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SECRET_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">envId:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ENV_ID</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">staticSrcPath:</span> <span class="string">public</span></span><br></pre></td></tr></table></figure><p>部署 Hexo 的过程中，<code>Deploy</code> 之前的都是差不多，所有之后只需要修改 <code>Deploy</code> 之后的内容就行。</p><h3 id="部署到-腾讯cos"><a class="markdownIt-Anchor" href="#部署到-腾讯cos"></a> 部署到 腾讯COS</h3><p>建议使用<a href="https://github.com/zkqiang/tencent-cos-action" target="_blank" rel="noopener external nofollow noreferrer">zkqiang/tencent-cos-action</a></p><h3 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h3><p>大部分都是有官方 Action 的，即使没有也会有其他人编写的，或参考官方文档。</p><h2 id="隐私问题"><a class="markdownIt-Anchor" href="#隐私问题"></a> 隐私问题</h2><p>可以直接使用 Private 仓库解决。</p><p>对于 Publlic 仓库，可以使用 <code>sed</code> 命令。</p><p>比如我在博客配置 <code>_config.yml</code> 文件中有百度推送的代码</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">baidu_url_submit:</span></span><br><span class="line">  <span class="attr">count:</span> <span class="number">200</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">blog.JalenChuh.cn</span></span><br><span class="line">  <span class="attr">token:</span> <span class="string">baiduToken</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">baidu_urls.txt</span></span><br></pre></td></tr></table></figure><p>其中 <code>token</code> 属于隐私内容，不能公开，那么我们可以使用 <code>baiduToken</code> 将 <code>token</code> 代替</p><p>而之后在编写的 Action 的时候将 <code>token</code> 存入 <code>secrets</code> ，利用 <code>sed</code> 命令对 <code>baiduToken</code> 进行替换即可。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">"s/baiduToken/<span class="variable">$&#123;baiduToken&#125;</span>/"</span> _config.yml</span><br></pre></td></tr></table></figure><p><code>sed -i</code> 用法为 <code>sed -i 's/原字符串/新字符串/' 文件路径</code></p><p>结合 <code>secrets</code> 使用</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">env</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="attr">baiduToken:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.baiduToken</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">run:</span> <span class="string">sed</span> <span class="string">-i</span> <span class="string">"s/baiduToken/$&#123;baiduToken&#125;/"</span> <span class="string">_config.yml</span></span><br></pre></td></tr></table></figure><h2 id="自动提交百度收录"><a class="markdownIt-Anchor" href="#自动提交百度收录"></a> 自动提交百度收录</h2><p>解决了这个问题我们就可以进行一些更好玩的了，比如百度自动推送</p><p>首先确保安装了 <code>hexo-baidu-url-submit</code>，并且 <code>package.json</code> 的 <code>dependencies</code> 中含有该插件。</p><blockquote class="blockquote-note blockquote-note__tip"><div class="blockquote-note__header"><div class="blockquote-note__icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></div>注意</div><div class="blockquote-note__content"><p><code>package.json</code> 中如果没有，必须使用 <code>npm i hexo-baidu-url-submit --save</code> 安装</p></div></blockquote><p>然后还是该文件，修改 <code>scripts</code> 部分</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  .......</span><br><span class="line">  "xx": "xxxx",</span><br><span class="line"><span class="addition">+  "baidupush": "hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy &amp;&amp; hexo deploy --config _baiduPush.yml"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><blockquote class="blockquote-note blockquote-note__warning"><div class="blockquote-note__header"><div class="blockquote-note__icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></div>必须遵循 json 规范</div><div class="blockquote-note__content"><p>最后一行，也就是 <code>baidupush</code> 这行结尾没有逗号，而倒数第二行必须有逗号</p></div></blockquote><p>如你所见，该命令执行了非常多次 <code>hexo deploy</code>，每次 <code>hexo deploy</code> 只会推送一次，而百度给了几千条的限额，那为什么不把全部额度用完呢？</p><p>但是还有一个问题，如果你使用的是 GitHub Page 之类的，每次推送的同时都会把博客也推送一遍，没这必要，那么我们可以新建一个配置文件 <code>_baidupush.yml</code> ，将 <code>_config.yml</code> 中我内容复制进去，再修改末尾 <code>deploy</code> 部分，仅保留百度推送。</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  - type: baidu_url_submitter</span><br><span class="line"><span class="deletion">-  - type: git</span></span><br><span class="line"><span class="deletion">-    repo: git@github.com:jalenchuh/test.git</span></span><br><span class="line"><span class="deletion">-    branch: master</span></span><br></pre></td></tr></table></figure><p>那么之前命令中的所有 <code>hexo deploy</code> 就需要相应的替换成 <code>hexo deploy --config _baidupush.yml</code></p><p>然后在 <code>secrets</code> 中存入 <code>baiduToken</code></p><p>并编写 Action，每天北京时间 0 点自动执行</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">baiduPush</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">cron:</span> <span class="string">'0 16 * * *'</span> <span class="comment"># Github Action 使用的是 UTC 时间</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">'10.x'</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Hexo</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">npm</span> <span class="string">install</span> <span class="string">hexo-cli</span> <span class="string">-g</span></span><br><span class="line">        <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">BAIDU</span> <span class="string">env</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="attr">baiduToken:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.baiduToken</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">run:</span> <span class="string">sed</span> <span class="string">-i</span> <span class="string">"s/baiduToken/$&#123;baiduToken&#125;/"</span> <span class="string">_baidupush.yml</span> <span class="comment"># 替换 baiduToken</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">generate</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">hexo</span> <span class="string">clean</span> <span class="string">&amp;&amp;</span> <span class="string">hexo</span> <span class="string">g</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">push</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">baidupush</span> <span class="comment"># 执行前面写好的命令</span></span><br></pre></td></tr></table></figure><h2 id="最后"><a class="markdownIt-Anchor" href="#最后"></a> 最后</h2><p>著名的 CI 工具还有 Travis CI，相比之下我觉得 GitHub Action 更加容易上手，而且和 GitHub 直接集成算是它的一大优势吧。</p><p>不过还是有一些缺点的，比如没办法本地调试，第一次使用 Action 列表中总是一片 ❌。还有就是出错之后 <code>re run</code> 只能全部重来，没办法指定从某一个 steps 开始</p><p>当然了，已经做的非常不错了。同时，期待下即将推出的 Codespaces。</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>GitHub Page 部署代码来自 <a href="https://hexo.fluid-dev.com/posts/actions-deploy/" target="_blank" rel="noopener external nofollow noreferrer">https://hexo.fluid-dev.com/posts/actions-deploy/</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section></div></div><div class="post__license"><p><strong>Author: </strong>Lioil</p><p><strong>Permalink: </strong><a href="https://www.linil.ml/posts/use-github-action.html">https://www.linil.ml/posts/use-github-action.html</a></p></div><div class="post-meta post-footer__meta"><p>最后更新于：Fri Aug 07 2020</p></div><div class="post-cats post-card__cats"><a href="/tags/%E6%95%99%E7%A8%8B/" class="post-tags__link button"># 教程</a> <a href="/tags/GitHub-Action/" class="post-tags__link button"># GitHub Action</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/" class="post-tags__link button"># 自动化</a></div></article></div></main><footer class="footer"><p><a style="color:#999;text-decoration:none" href="https://www.linik.ml" target="_blank" rel="noopener">Lioil</a> ©2020</p><p>Powered by <a href="https://hexo.io" rel="external nofollow noreferrer" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" rel="external nofollow noreferrer" target="_blank">Cards</a></p></footer></div><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@12.0.0/dist/lazyload.min.js"></script><script>window.lazyLoadOptions={elements_selector:".lazyload",threshold:0}</script></body></html>